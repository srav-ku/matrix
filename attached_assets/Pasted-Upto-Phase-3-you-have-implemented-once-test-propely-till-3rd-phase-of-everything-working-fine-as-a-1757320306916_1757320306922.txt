Upto Phase 3 you have implemented, (once test propely till 3rd phase of everything working fine as asked)



PHASE 4 — Authentication basics + signup + Firebase email verification
Goal: Let developers register with allowed domains + verify via Firebase Auth’s built-in email verification. Only verified users get an API key issued later.

Tasks

Signup endpoint:
Validate email domain (allow list: gmail.com, yahoo.com, outlook.com).
Check against a disposable domain blocklist (local JSON).
Hash password (use a secure edge-friendly approach).
Create Firebase Auth user.
Trigger Firebase’s sendEmailVerification.
Verify endpoint:
Check users.emailVerified via Firebase.
On success, mark users.verified=1 in DB.
Generate raw API key (UUID) and store hashed key in api_keys, but return the raw key to user once.
Resends & lockouts:
Enforce a cooldown for resending verification emails (e.g., 1 minute).
Prevent abuse with rate-limits (lockout after 5 failed API calls for 15 minutes).
Firebase templates:
Customize email verification template in Firebase Console and test email delivery.
Expected outcome

A developer can signup with a Gmail/Yahoo/Outlook address, receive a Firebase verification email, and verify.
After verification, they receive a raw API key (visible once) and a DB record is created.
Attempts with disposable email are rejected.
How to test / Acceptance

Signup with Gmail → check Firebase sent verification email (Firebase Console + inbox).
Verify via Firebase link → API returns raw key; D1 shows api_keys row hashed.
Disposable email is rejected.
Estimated time: 8–16 hours

Pitfalls

Firebase requires customizing the default email templates.
Ensure cooldown and lockout logic prevents abuse (Firebase protects tokens, but resend spam needs backend throttling).




Credentials:

- Cloudflare

    

    

    D1 Id - ee657852-10fb-4a3a-b3f9-a130a0479fe7

    

    Name - the_matrix

    

    API - jy5Mj1LBXyzI23pN-N7RZv2Hf_NAOmpSZ4j01P3C

    

    curl "https://api.cloudflare.com/client/v4/user/tokens/verify" \

    

    -H "Authorization: Bearer jy5Mj1LBXyzI23pN-N7RZv2Hf_NAOmpSZ4j01P3C"

    

    Account Id - a3bdf9482d60e7e21613c94fdd4b0c9a

    



    

- Cloudinary

    

    API Secret - h8M37uQTcwHEHa0Ju_J6GEafvMo

    

    API Key - 422255243611114

    

    Cloud Name - ds1sfucwb